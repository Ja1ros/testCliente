{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/jairo/Desktop/Angular/RenderClient/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ElementRef } from \"@angular/core\";\nimport { UsuariosService } from \"app/Services/usuarios.service\";\nimport { DataTableDirective } from \"angular-datatables\";\nimport { Subject } from \"rxjs\";\nimport { ToastrService } from \"ngx-toastr\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"app/Services/usuarios.service\";\nimport * as i2 from \"ngx-toastr\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"angular-datatables\";\nimport * as i5 from \"@angular/forms\";\nconst _c0 = [\"closeModalUsuario\"];\n\nfunction UsuarioComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 26)(1, \"button\", 27);\n    i0.ɵɵtext(2, \" Agregar \");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nexport let UsuarioComponent = /*#__PURE__*/(() => {\n  class UsuarioComponent {\n    constructor(userService, toastr) {\n      this.userService = userService;\n      this.toastr = toastr;\n      this.usuarios = [];\n      this.dtOptionsU = {};\n      this.dtTriggerU = new Subject();\n      this.dtOptions = {};\n      this.rol = \"\";\n      this.usuario = {\n        id: 0,\n        cedula: \"\",\n        username: \"\",\n        password: \"\",\n        nombres: \"\",\n        estado: 1\n      };\n    }\n\n    ngOnInit() {\n      this.rol = JSON.parse(localStorage.getItem(\"rol\"));\n      this.dtOptionsU = {\n        ajax: (dataTablesParameters, callback) => {\n          this.userService.getUsuarios().subscribe(data => {\n            callback({\n              data: data.data\n            });\n          });\n        },\n        language: {\n          url: \"https://cdn.datatables.net/plug-ins/1.13.1/i18n/es-ES.json\"\n        },\n        columns: [{\n          title: \"ID\",\n          data: \"ID\"\n        }, {\n          title: \"Cédula\",\n          data: \"Cedula\"\n        }, {\n          title: \"Nombres\",\n          data: \"Nombres\"\n        }, {\n          title: \"Usuario\",\n          data: \"UserName\"\n        }, {\n          title: \"Password\",\n          data: \"UserPassword\",\n          render: function (data) {\n            return data.substring(0, 10) + \"...\";\n          }\n        }],\n        columnDefs: [{\n          targets: 5,\n          title: \"Estado\",\n          data: \"Estado\",\n          render: function (data, type, row) {\n            return data == 1 ? `<span class=\"badge bg-info\">Activo</span>` : `<span class=\"badge bg-danger\">Inactivo</span>`;\n          }\n        }, {\n          targets: 6,\n          title: \"Opciones\",\n          data: null,\n          render: function (data, type, row) {\n            return `<button\n            #Editar\n          id=\"EditarUsuario\"\n          type=\"button\"\n          class=\"btn btn-info btn-sm\"\n          data-toggle=\"modal\"\n          data-target=\"#exampleModal\"\n        >\n          <i class=\"nc-icon nc-tag-content\"></i>\n        </button>\n\n        <button\n          id=\"btnEliminarUsuario\" \n          class=\"btn btn-danger btn-sm\"\n        >\n          <i class=\"nc-icon nc-simple-remove\"></i>\n        </button>`;\n          }\n        }]\n      };\n    }\n\n    ngAfterViewInit() {\n      var _thisDoc = this;\n\n      $(\"#usuario-table\").on(\"click\", \"#EditarUsuario\", function (data) {\n        let datas = $(\"#usuario-table\").DataTable().row($(this).parents(\"tr\")).data();\n\n        _thisDoc.Editar(datas);\n      });\n      $(\"#usuario-table\").on(\"click\", \"#btnEliminarUsuario\", function (data) {\n        let datas = $(\"#usuario-table\").DataTable().row($(this).parents(\"tr\")).data();\n\n        _thisDoc.EliminarUsuario(datas);\n      });\n    }\n\n    reload() {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        let dt = yield _this.dtElement.dtInstance;\n        dt.ajax.reload();\n      })();\n    }\n\n    EditarUsuario() {}\n\n    getUsuario() {\n      this.dtOptions = {\n        pagingType: \"full_numbers\",\n        ordering: false,\n        language: {\n          url: \"https://cdn.datatables.net/plug-ins/1.13.1/i18n/es-ES.json\"\n        },\n        destroy: true\n      };\n      this.userService.getUsuarios().subscribe(resp => {\n        this.usuarios = resp.data;\n        this.dtTriggerU.next(this.usuarios);\n      });\n    }\n\n    showNotification(from, align, color, message) {\n      switch (color) {\n        case 1:\n          this.toastr.info(`<span data-notify=\"icon\" class=\"nc-icon nc-bell-55\"></span><span data-notify=\"message\"> ${message}</span>`, \"\", {\n            timeOut: 4000,\n            closeButton: true,\n            enableHtml: true,\n            toastClass: \"alert alert-info alert-with-icon\",\n            positionClass: \"toast-\" + from + \"-\" + align\n          });\n          break;\n\n        case 2:\n          this.toastr.success(`<span data-notify=\"icon\" class=\"nc-icon nc-bell-55\"></span><span data-notify=\"message\">${message}</span>`, \"\", {\n            timeOut: 4000,\n            closeButton: true,\n            enableHtml: true,\n            toastClass: \"alert alert-success alert-with-icon\",\n            positionClass: \"toast-\" + from + \"-\" + align\n          });\n          break;\n\n        case 3:\n          this.toastr.warning(`<span data-notify=\"icon\" class=\"nc-icon nc-bell-55\"></span><span data-notify=\"message\"> ${message}</span>`, \"\", {\n            timeOut: 4000,\n            closeButton: true,\n            enableHtml: true,\n            toastClass: \"alert alert-warning alert-with-icon\",\n            positionClass: \"toast-\" + from + \"-\" + align\n          });\n          break;\n\n        case 4:\n          this.toastr.error(`<span data-notify=\"icon\" class=\"nc-icon nc-bell-55\"></span><span data-notify=\"message\"> ${message}</span>`, \"\", {\n            timeOut: 4000,\n            enableHtml: true,\n            closeButton: true,\n            toastClass: \"alert alert-danger alert-with-icon\",\n            positionClass: \"toast-\" + from + \"-\" + align\n          });\n          break;\n\n        case 5:\n          this.toastr.show(`<span data-notify=\"icon\" class=\"nc-icon nc-bell-55\"></span><span data-notify=\"message\"> ${message}</span>`, \"\", {\n            timeOut: 4000,\n            closeButton: true,\n            enableHtml: true,\n            toastClass: \"alert alert-primary alert-with-icon\",\n            positionClass: \"toast-\" + from + \"-\" + align\n          });\n          break;\n\n        default:\n          break;\n      }\n    }\n\n    validarUsuario() {\n      if (this.usuario.cedula.length < 10) {\n        this.showNotification(\"top\", \"center\", 3, \"La Cédula debe tener 10 dígitos\");\n        return false;\n      }\n\n      if (!this.validarCed(this.usuario.cedula.trim())) {\n        this.showNotification(\"top\", \"center\", 3, \"La Cédula no es válida\");\n        return false;\n      }\n\n      if (this.usuario.nombres.length < 3) {\n        this.showNotification(\"top\", \"center\", 3, \"El nombre debe más de 3 dígitos\");\n        return false;\n      }\n\n      if (this.usuario.username.length < 4) {\n        this.showNotification(\"top\", \"center\", 3, \"Debe ingresar un usuario\");\n        return false;\n      }\n\n      return true;\n    }\n\n    GuardarUsuario() {\n      var _this2 = this;\n\n      if (this.usuario.id == 0) {\n        if (!this.validarUsuario()) {\n          return;\n        }\n\n        this.userService.postUsuarios(this.usuario).subscribe( /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (data) {\n            _this2.showNotification(\"top\", \"center\", 2, data.msg);\n\n            yield _this2.reload();\n            _this2.usuario = {\n              id: 0,\n              cedula: \"\",\n              username: \"\",\n              password: \"\",\n              nombres: \"\",\n              estado: 1\n            };\n\n            _this2.closeModalUsuario.nativeElement.click(); //<-- here\n\n          });\n\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }(), err => {\n          console.log(err);\n\n          if (err[\"error\"].errors != undefined) {\n            let msg = \"\";\n            let cant = err[\"error\"].errors.length;\n\n            for (let index = 0; index < cant; index++) {\n              const element = err[\"error\"].errors[index];\n\n              if (index + 1 == cant) {\n                msg += element.msg;\n              } else {\n                msg += element.msg + \", \";\n              }\n            }\n\n            this.showNotification(\"top\", \"center\", 4, msg);\n          } else {\n            let er = err[\"error\"];\n            this.showNotification(\"top\", \"center\", 4, er.msg);\n          }\n        });\n      } else {\n        this.userService.putUsuarios(this.usuario).subscribe( /*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator(function* (data) {\n            _this2.showNotification(\"top\", \"center\", 2, data.msg);\n\n            yield _this2.reload();\n            _this2.usuario = {\n              id: 0,\n              cedula: \"\",\n              username: \"\",\n              password: \"\",\n              nombres: \"\",\n              estado: 1\n            };\n\n            _this2.closeModalUsuario.nativeElement.click(); //<-- here\n\n          });\n\n          return function (_x2) {\n            return _ref2.apply(this, arguments);\n          };\n        }(), err => {\n          console.log(err);\n\n          if (err[\"error\"].errors != undefined) {\n            let msg = \"\";\n            let cant = err[\"error\"].errors.length;\n\n            for (let index = 0; index < cant; index++) {\n              const element = err[\"error\"].errors[index];\n\n              if (index + 1 == cant) {\n                msg += element.msg;\n              } else {\n                msg += element.msg + \", \";\n              }\n            }\n\n            this.showNotification(\"top\", \"center\", 4, msg);\n          } else {\n            let er = err[\"error\"];\n            this.showNotification(\"top\", \"center\", 4, er.msg);\n          }\n        });\n      }\n    }\n\n    validarCed(ced) {\n      var cad = ced;\n      var total = 0;\n      var longitud = cad.length;\n      var longcheck = longitud - 1;\n\n      if (cad !== \"\" && longitud === 10) {\n        for (let i = 0; i < longcheck; i++) {\n          if (i % 2 === 0) {\n            var aux = cad.charAt(i) * 2;\n            if (aux > 9) aux -= 9;\n            total += aux;\n          } else {\n            total += parseInt(cad.charAt(i));\n          }\n        }\n\n        total = total % 10 ? 10 - total % 10 : 0;\n\n        if (cad.charAt(longitud - 1) == total) {\n          return true;\n        } else {\n          return false;\n        }\n      }\n    }\n\n    Editar(usuario) {\n      this.usuario.id = usuario.ID;\n      this.usuario.username = usuario.UserName;\n      this.usuario.cedula = usuario.Cedula;\n      this.usuario.nombres = usuario.Nombres;\n      this.usuario.estado = 1;\n    }\n\n    EliminarUsuario(usuario) {\n      var _this3 = this;\n\n      this.usuario.id = usuario.ID;\n      this.usuario.nombres = usuario.Nombres;\n      this.usuario.username = usuario.UserName;\n      this.usuario.cedula = usuario.Cedula;\n      this.usuario.estado = 0;\n      this.userService.putUsuarios(this.usuario).subscribe( /*#__PURE__*/function () {\n        var _ref3 = _asyncToGenerator(function* (data) {\n          _this3.showNotification(\"top\", \"center\", 2, data.msg);\n\n          yield _this3.reload();\n          _this3.usuario = {\n            id: 0,\n            cedula: \"\",\n            username: \"\",\n            password: \"\",\n            nombres: \"\",\n            estado: 1\n          };\n\n          _this3.closeModalUsuario.nativeElement.click(); //<-- here\n\n        });\n\n        return function (_x3) {\n          return _ref3.apply(this, arguments);\n        };\n      }(), err => {\n        console.log(err);\n\n        if (err[\"error\"].errors != undefined) {\n          let msg = \"\";\n          let cant = err[\"error\"].errors.length;\n\n          for (let index = 0; index < cant; index++) {\n            const element = err[\"error\"].errors[index];\n\n            if (index + 1 == cant) {\n              msg += element.msg;\n            } else {\n              msg += element.msg + \", \";\n            }\n          }\n\n          this.showNotification(\"top\", \"center\", 4, msg);\n        } else {\n          let er = err[\"error\"];\n          this.showNotification(\"top\", \"center\", 4, er.msg);\n        }\n      });\n    }\n\n  }\n\n  UsuarioComponent.ɵfac = function UsuarioComponent_Factory(t) {\n    return new (t || UsuarioComponent)(i0.ɵɵdirectiveInject(i1.UsuariosService), i0.ɵɵdirectiveInject(i2.ToastrService));\n  };\n\n  UsuarioComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UsuarioComponent,\n    selectors: [[\"app-usuario\"]],\n    viewQuery: function UsuarioComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(DataTableDirective, 5);\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.dtElement = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.closeModalUsuario = _t.first);\n      }\n    },\n    decls: 34,\n    vars: 6,\n    consts: [[1, \"row\"], [1, \"col-md-12\"], [1, \"card\"], [1, \"card-header\"], [1, \"card-title\"], [\"class\", \"text-right\", 4, \"ngIf\"], [1, \"card-body\"], [1, \"table-responsive\", \"table-dark\", \"table-striped\"], [\"id\", \"usuario-table\", \"datatable\", \"\", 1, \"row-border\", \"hover\", 3, \"dtOptions\"], [\"id\", \"exampleModal\", \"tabindex\", \"-1\", \"role\", \"dialog\", \"aria-labelledby\", \"exampleModalLabel\", \"aria-hidden\", \"true\", 1, \"modal\", \"fade\"], [\"role\", \"document\", 1, \"modal-dialog\"], [1, \"modal-content\"], [1, \"modal-header\"], [\"id\", \"exampleModalLabel\", 1, \"modal-title\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", \"aria-label\", \"Close\", 1, \"close\"], [\"aria-hidden\", \"true\"], [1, \"modal-body\"], [1, \"form-group\", \"position-relative\", \"has-icon-left\"], [\"name\", \"txtCed\", \"placeholder\", \"C\\u00E9dula\", \"onkeypress\", \"return event.charCode >= 48\", \"min\", \"1\", \"id\", \"txtCed\", \"oninput\", \"javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);\", \"type\", \"text\", \"maxlength\", \"10\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"id\", \"txtNom\", \"type\", \"text\", \"placeholder\", \"Nombres\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"id\", \"txtCorreo\", \"type\", \"text\", \"placeholder\", \"Usuario\", \"required\", \"\", \"pattern\", \"^[a-z0-9._%+-]+@[a-z0-9.-]+\\\\\\\\.[a-z]{2,4}$\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"id\", \"txtPassword\", \"type\", \"password\", \"placeholder\", \"Password\", \"placeholder\", \"Password\", \"required\", \"\", \"pattern\", \"^(?=.[a-z])(?=.[A-Z])(?=.\\\\d)(?=.[@$!%?&])[A-Za-z\\\\d@$!%?&]{8,}$\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"modal-footer\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", 1, \"btn\", \"btn-secondary\"], [\"closeModalUsuario\", \"\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"text-right\"], [\"type\", \"button\", \"data-toggle\", \"modal\", \"data-target\", \"#exampleModal\", 1, \"btn\", \"btn-primary\"]],\n    template: function UsuarioComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"h4\", 4);\n        i0.ɵɵtext(5, \"Listado Usuario\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(6, UsuarioComponent_div_6_Template, 3, 0, \"div\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"div\", 6)(8, \"div\", 7);\n        i0.ɵɵelement(9, \"table\", 8);\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵelementStart(10, \"div\", 9)(11, \"div\", 10)(12, \"div\", 11)(13, \"div\", 12)(14, \"h5\", 13);\n        i0.ɵɵtext(15, \" Usuario\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"button\", 14)(17, \"span\", 15);\n        i0.ɵɵtext(18, \"\\u00D7\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(19, \"div\", 16)(20, \"div\", 17)(21, \"input\", 18);\n        i0.ɵɵlistener(\"ngModelChange\", function UsuarioComponent_Template_input_ngModelChange_21_listener($event) {\n          return ctx.usuario.cedula = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(22, \"div\", 17)(23, \"input\", 19);\n        i0.ɵɵlistener(\"ngModelChange\", function UsuarioComponent_Template_input_ngModelChange_23_listener($event) {\n          return ctx.usuario.nombres = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(24, \"div\", 17)(25, \"input\", 20);\n        i0.ɵɵlistener(\"ngModelChange\", function UsuarioComponent_Template_input_ngModelChange_25_listener($event) {\n          return ctx.usuario.username = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(26, \"div\", 17)(27, \"input\", 21);\n        i0.ɵɵlistener(\"ngModelChange\", function UsuarioComponent_Template_input_ngModelChange_27_listener($event) {\n          return ctx.usuario.password = $event;\n        });\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(28, \"div\", 22)(29, \"button\", 23, 24);\n        i0.ɵɵtext(31, \" Cancelar \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"button\", 25);\n        i0.ɵɵlistener(\"click\", function UsuarioComponent_Template_button_click_32_listener() {\n          return ctx.GuardarUsuario();\n        });\n        i0.ɵɵtext(33, \" Guardar \");\n        i0.ɵɵelementEnd()()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", ctx.rol == \"Admin\" || ctx.rol == \"User\");\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"dtOptions\", ctx.dtOptionsU);\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"ngModel\", ctx.usuario.cedula);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.usuario.nombres);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.usuario.username);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.usuario.password);\n      }\n    },\n    dependencies: [i3.NgIf, i4.DataTableDirective, i5.DefaultValueAccessor, i5.NgControlStatus, i5.RequiredValidator, i5.MaxLengthValidator, i5.PatternValidator, i5.NgModel]\n  });\n  return UsuarioComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}